import{r as i,j as e,a as oe}from"./react-BL4LEYSH.js";import{i as le,N as ie,a as ae}from"./vendor-C8VTLH0V.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const a of l.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function s(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(r){if(r.ep)return;r.ep=!0;const l=s(r);fetch(r.href,l)}})();const W="RDFSheetLocalStorageKey",Z=window.localStorage,H={prefixes:"@prefix dc: <http://purl.org/dc/terms/> .",idp:"https://solidcommunity.net",clientIDs:[]},Y=i.createContext(void 0),ce=({children:t})=>{const[n,s]=i.useState(()=>{const r=Z.getItem(W);if(r)try{const l=JSON.parse(r);if(l&&typeof l=="object")return{...H,...l}}catch(l){return console.warn("設定の読み込みに失敗しました。",l),console.warn("設定を初期化します。"),H}});i.useEffect(()=>{Z.setItem(W,JSON.stringify(n))},[n]);const o=r=>{s(l=>({...l,...r}))};return e.jsx(Y.Provider,{value:{appData:n,updateAppData:o},children:t})},Q=()=>{const t=i.useContext(Y);if(!t)throw new Error("useAppData must be used within a AppDataProvider");return t},{handleIncomingRedirect:ue,login:de,logout:pe,fetch:he}=window.solidClientAuthentication,fe="RDFSheetLocalStorageKey",me=window.localStorage,G=he;async function xe(t,n,s){return new Promise((o,r)=>{const l={format:"text/turtle",baseIRI:s};new ae(l).parse(t,(d,h,f)=>{d?r(d):h?n.addQuad(h):o(f)})})}function ge(){const t=me.getItem(fe);if(t)try{const n=JSON.parse(t);if(n&&typeof n=="object")return{...H,...n}}catch{}else return{prefixes:"@prefix dc: <http://purl.org/dc/terms/> .",idp:"https://solidweb.me","":""}}const Se=async t=>{const n=ge();let s=null;for(const r of n.clientIDs)if(t.indexOf(r.provider)>=0){s=r;break}const o={oidcIssuer:t};s&&(o.clientId=atob(s.id),o.clientSecret=atob(s.secret)),await de(o)},ve=()=>{pe()};let B=null;async function je(){const t=await ue();t&&t.isLoggedIn?t.webId&&(B=t.webId):B=null}const A=window.luckysheet,k={settings:{sheets:[],fileSettings:{podUrl:""}}},ye=()=>({index:"iTha4zah",name:"??????????",status:0,repRange:"",prefixes:"",oneTimeTemplate:"",iterationTemplate:"",additionalImportUrls:"",oneTimeImportSparql:"",iterationImportSparql:"",rdfPodUrl:"https://example.org/my_pod/rdfsheet.ttl"}),X=()=>({sheets:[],fileSettings:{podUrl:"https://example.org/my_pod/rdfsheet.rdfs"}}),U=()=>{const t=A.getAllSheets(),n=k.settings.sheets,s=[];return t.forEach(o=>{const r=n.reduce((l,a)=>l||(a.index===o.index.toString()?a:l),null);if(r!==null)r.name=o.name,r.status=Number(o.status),s.push(r);else{const l=ye();l.index=o.index.toString(),l.name=o.name,l.status=Number(o.status),s.push(l)}}),k.settings.sheets=s,k.settings};function F(t){return t instanceof Error?t.message:String(t)}function M(t){const n={container:"luckysheet",data:void 0,showinfobar:!1,showtoolbar:!0,sheetFormulaBar:!0,showsheetbar:!0,showstatisticBar:!0};t.luckysheetfile&&(n.data=t.luckysheetfile),t.settings&&(k.settings=t.settings),A.create(n),U()}async function Te(){try{const t={types:[{description:"RDFSheet file",accept:{"application/x-rdfsheet+json":[".rdfs"]}}]},[n]=await window.showOpenFilePicker(t),o=await(await n.getFile()).text(),r=JSON.parse(o);M(r)}catch(t){alert(`ファイルは開かれませんでした。${F(t)}`)}}async function be(t){try{const s=await(await G(t)).json();M(s)}catch(n){alert(`ファイルの読み込みに失敗しました。${F(n)}`)}}async function we(){try{const t={luckysheetfile:A.getluckysheetfile(),settings:JSON.parse(JSON.stringify(k.settings))},n={suggestedName:"rdfsheetfile.rdfs",types:[{description:"RDFSheet file",accept:{"application/x-rdfsheet+json":[".rdfs"]}}]},o=await(await window.showSaveFilePicker(n)).createWritable();await o.write(JSON.stringify(t)),await o.close()}catch(t){alert(`ファイルは保存されませんでした。${F(t)}`)}}async function Ce(t){try{const n={luckysheetfile:A.getluckysheetfile(),settings:JSON.parse(JSON.stringify(k.settings))};await G(t,{method:"PUT",headers:{"Content-Type":"application/x-rdfsheet+json"},body:JSON.stringify(n)}),alert("ファイルを保存しました。")}catch(n){alert(`ファイルの保存に失敗しました。${F(n)}`)}}async function ee(t,n){const s=k.settings.sheets.reduce((r,l,a)=>r!=-1?r:l.status===1?a:r,-1),o=k.settings.sheets[s];if(o)try{const r=new le.QueryEngine,l=new ie;await xe(t,l,n);const a=[l];for(const m of o.additionalImportUrls.split(`
`))m!==""&&a.push(m);const d=`BASE <${n}>
`+o.oneTimeImportSparql,f=await(await r.queryBindings(d,{sources:a})).toArray(),y={isRefresh:!0};if(f.length>=1)for(const[m,g]of f[0]){console.log(`GAHA: ${m.value}<=${g.value}`);const p=N(m.value);A.setCellValue(p.row,p.col,g.value,y)}else alert("The result of oneTimeSparql is empty.");if(o.repRange!==""){const m=o.repRange.split(":")[0],g=o.repRange.split(":")[1],p=N(m),v=N(g),x=`BASE <${n}>
`+o.iterationImportSparql,u=await r.query(x,{sources:a});if(u.resultType!=="bindings")throw new Error("iterationImportSparql is not SELECT query.");const c=await u.metadata(),_=await(await u.execute()).toArray();alert(`The result count of iterationImportSparql is ${_.length}.`);let D=c.variables;for(let R=p.row+1;R<=v.row+1;R++){const I=_.shift();if(I!=null)for(const[P,S]of I){const j=N(`${P.value}${R}`);A.setCellValue(j.row,j.col,S.value,y)}else for(const P of D){const S=N(`${P.value}${R}`);A.setCellValue(S.row,S.col,"",y)}}}A.refreshFormula()}catch{throw new Error("インポートエラー")}else return alert("アクティブなシートがありません？！"),null}async function Re(){U();try{const t={types:[{description:"Turtle(RDF) file",accept:{"text/turtle":[".ttl"]}}]},[n]=await window.showOpenFilePicker(t),s=await n.getFile(),o=await s.text(),r=`file:///C:/Users/me/RDFSheet/${s.name}`;await ee(o,r)}catch(t){alert(`ファイルは開かれませんでした。${F(t)}`)}}async function Ie(t){U();try{const s=await(await G(t)).text();await ee(s,t)}catch(n){alert(`ファイルの読み込みに失敗しました。${F(n)}`)}}function te(){const t=k.settings.sheets.reduce((s,o,r)=>s!=-1?s:o.status===1?r:s,-1),n=k.settings.sheets[t];if(n){const s={type:"v",order:t};let o="";o+=n.prefixes;let r=n.oneTimeTemplate.matchAll(/<<([A-Za-z]+)(\d+)>>/g),l=[...r].map(h=>`${h[1]}${h[2]}`),a={};for(const h of l){const f=N(h);a[h]=A.getCellValue(f.row,f.col,s)}let d=n.oneTimeTemplate;for(const h of Object.keys(a))d=d.replace(`<<${h}>>`,a[h]);if(o+=d,n.repRange!==""){r=n.oneTimeTemplate.matchAll(/<<([A-Za-z]+)(\d+)>>/g),l=[...r].map(p=>`${p[1]}${p[2]}`),a={};for(const p of l){const v=N(p);a[p]=A.getCellValue(v.row,v.col,s)}d=n.iterationTemplate;for(const p of Object.keys(a))d=d.replace(`<<${p}>>`,a[p]);r=n.iterationTemplate.matchAll(/<<([A-Za-z]+)>>/g),l=[...r].map(p=>p[1]);const h=n.repRange.split(":")[0],f=n.repRange.split(":")[1],y=N(h),m=N(f);let g=0;e:for(let p=y.row;p<=m.row;p++){let v=d;a={};for(const x of l){const u=ne(x);if(a[x]=A.getCellValue(p,u,s),a[x]==null){a={},g++;continue e}}for(const x of Object.keys(a))v=v.replace(`<<${x}>>`,a[x]);o+=v}g!==0&&alert(`繰り返し処理中に必要なデータが無かったためにとばした行が${g}行ありました。`)}return o}else return alert("アクティブなシートがありません？！"),null}async function Ae(){U();const t=te();try{const n={suggestedName:"rdfsheetfile.ttl",types:[{description:"Turtle(RDF) file",accept:{"text/turtle":[".ttl"]}}]},o=await(await window.showSaveFilePicker(n)).createWritable();await o.write(t),await o.close()}catch(n){alert(`RDFファイルは保存されませんでした。${F(n)}`)}}async function _e(t){U();const n=te();try{await G(t,{method:"PUT",headers:{"Content-Type":"text/turtle"},body:n}),alert("RDFをエクスポートしました。")}catch(s){alert(`RDFのエクスポートに失敗しました。${F(s)}`)}}function ke(){window.open("https://github.com/ksaito-hiu/RDFSheet/tree/main/help","help","width=600,height=400,left=100,top=100,resizable=yes,scrollbars=yes")}function De(){window.open("https://github.com/ksaito-hiu/RDFSheet/","about","width=600,height=400,left=100,top=100,resizable=yes,scrollbars=yes")}const ne=t=>{const n=t.toUpperCase();let s=0;for(let o=n.length-1;o>=0;o--)s*=25,s+="ABCDEFGHIJKLMNOPQRSTUVWXYZ".indexOf(n.charAt(o));return s},N=t=>{const n=t.match(/^([A-Za-z]+)(\d+)$/i);if(!n)throw new Error("無効なセル式です。");const[,s,o]=n,r=ne(s),l=Number(o)-1;return{col:r,row:l}},se=()=>{const t=A.getRangeAxis(),n=A.getAllSheets();let s;for(const o of n)Number(o.status)===1&&(s=o.index.toString());return{range:t[0],sheetIdx:s}},Ne="_headerPanels_ymhxh_8",Le={headerPanels:Ne},O=({isVisible:t,onClose:n,children:s})=>{const o=i.useRef(null),r=()=>{n()};return i.useEffect(()=>{const l=o.current;l&&(t?l.open||(l.showModal(),l.addEventListener("close",r)):l.open&&(l.removeEventListener("close",r),l.close()))},[t]),t?e.jsxs("dialog",{ref:o,style:{zIndex:3e3,width:"80%"},children:[e.jsx("div",{style:{border:"black"},children:s}),e.jsx("button",{onClick:()=>{var l;return(l=o.current)==null?void 0:l.close()},children:"close"})]}):null},Fe=()=>{const{appData:t,updateAppData:n}=Q(),[s,o]=i.useState(B!==null),[r,l]=i.useState(B===null?"not logged in":B),[a,d]=i.useState("https://solidcommunity.net"),[h,f]=i.useState(!1);i.useEffect(()=>{const p=t&&t.idp?t.idp:"https://solidcommunity.net";d(p)},[t]);const y=p=>{d(p.target.value)},m=async()=>{n({idp:a}),await Se(a),l(B===null?"not logged in":B),f(!1)},g=()=>{ve(),o(!1),l("not logged in"),f(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("button",{onClick:()=>{f(!0)},children:s?"logout or relogin":"login"}),e.jsxs("span",{style:{marginLeft:"1em"},children:["WebID: ",r]})]}),e.jsxs(O,{isVisible:h,onClose:()=>f(!1),children:[e.jsx("h4",{children:"ログイン・ログアウト"}),e.jsx("p",{children:"ログインしたい時はidpに認証サーバを直接入力するか、代表的な認証サーバのボタンを押し「Login」ボタンを押して下さい。ログアウトしたい時は「Logout」ボタンを押して下さい。"}),e.jsxs("div",{style:{display:"flex"},children:["idp: ",e.jsx("input",{type:"text",value:a,onChange:y,style:{flexGrow:1}}),e.jsx("button",{onClick:m,children:"Login"})]}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("button",{onClick:()=>{d("https://solidcommunity.net")},children:"Solid Community"})}),e.jsx("li",{children:e.jsx("button",{onClick:()=>{d("https://solidweb.me")},children:"solidweb.me"})}),e.jsx("li",{children:e.jsx("button",{onClick:()=>{d("https://solidweb.org")},children:"solidweb.org"})}),e.jsx("li",{children:e.jsx("button",{onClick:()=>{d("https://login.inrupt.com")},children:"Inrupt Identity Provider"})})]}),e.jsx("p",{children:e.jsx("button",{onClick:g,children:"Logout"})})]})]})},Pe="_menu_div_12okm_2",Be="_hamburger_12okm_9",Ue="_menu_close_12okm_23",Ee="_menu_open_12okm_35",V={menu_div:Pe,hamburger:Be,menu_close:Ue,menu_open:Ee},Oe=({onSelect:t})=>{const[n,s]=i.useState(!1),o=r=>{s(!1),t(r)};return e.jsxs("div",{className:V.menu_div,children:[e.jsx("button",{className:V.hamburger,onClick:()=>s(!n),children:n?"×":"☰"}),e.jsx("nav",{className:n?V.menu_open:V.menu_close,children:e.jsxs("ul",{children:[e.jsx("li",{onClick:()=>{o("help")},children:"Help"}),e.jsx("li",{onClick:()=>{o("about")},children:"About"})]})})]})},$e=({isVisible:t,children:n})=>(i.useEffect(()=>{t&&window.luckysheet.resize()},[t]),e.jsx("div",{style:{display:t?"block":"none",width:"100vw",height:"100%"},children:n})),qe=({onLoad:t})=>{const n=i.useRef(!1);i.useEffect(()=>{if(n.current)return;n.current=!0;let o;try{const r=localStorage.getItem("RDFSheetTempFile");r?(o=JSON.parse(r),localStorage.removeItem("RDFSheetTempFile")):o={luckysheetfile:void 0,settings:X()}}catch{o={luckysheetfile:void 0,settings:X()}}M(o),U(),t(o.settings)},[]);const s={margin:"0px",padding:"0px",width:"100%",height:"100%"};return e.jsx("div",{id:"luckysheet",style:s})},ze="_allSettings_zrny4_3",Ve="_selectedSheetDiv_zrny4_31",Je="_saveBtn_zrny4_40",Ge="_repRangeDiv_zrny4_44",He="_prefixDiv_zrny4_48",Qe="_glue_zrny4_52",Me="_prefixTA_zrny4_56",Ke="_importPrefixBtn_zrny4_63",We="_oneTimeTemplateTA_zrny4_67",Ze="_iterationTemplateTA_zrny4_74",Xe="_additionalImportUrlsTA_zrny4_81",Ye="_oneTimeImportSparqlTA_zrny4_88",et="_iterationImportSparqlTA_zrny4_95",tt="_pathDiv_zrny4_102",T={allSettings:ze,selectedSheetDiv:Ve,saveBtn:Je,repRangeDiv:Ge,prefixDiv:He,glue:Qe,prefixTA:Me,importPrefixBtn:Ke,oneTimeTemplateTA:We,iterationTemplateTA:Ze,additionalImportUrlsTA:Xe,oneTimeImportSparqlTA:Ye,iterationImportSparqlTA:et,pathDiv:tt},nt=({settings:t,onExported:n})=>{const s=i.useRef(null);i.useEffect(()=>{const l=t.sheets.reduce((a,d)=>a!==null?a:d.status===1?d.rdfPodUrl:a,null);l&&s.current&&(s.current.value=l)},[t]);const o=()=>{Ae(),n()},r=()=>{if(!s.current)return;const l=s.current.value;_e(l),n()};return e.jsxs(e.Fragment,{children:[e.jsx("h4",{children:"ExportComponent"}),e.jsx("div",{children:e.jsx("button",{type:"button",onClick:o,children:"export to local"})}),e.jsxs("div",{style:{display:"flex",margin:"1em 0"},children:[e.jsx("button",{type:"button",onClick:r,children:"export to pod"}),e.jsx("input",{type:"text",ref:s,style:{flexGrow:1}})]})]})},st=({settings:t,onChange:n})=>{const[s,o]=i.useState(!1),[r,l]=i.useState(t.sheets[0]),[a,d]=i.useState("iTha4zah"),[h,f]=i.useState(!1),[y,m]=i.useState(!1),[g,p]=i.useState(!1),v=i.useRef(null),x=i.useRef(null),u=i.useRef(null),c=i.useRef(null),w=i.useRef(null),_=i.useRef(null),D=i.useRef(null),R=i.useRef(null),I=i.useRef(null),{appData:P}=Q();i.useEffect(()=>{const b=t.sheets.reduce((C,E)=>C!==null?C:E.status===1?E.index:C,null);S(b)},[t]);const S=b=>{if(h&&!window.confirm("設定を保存せずにシートを変更しますか？"))return;f(!1);const C=t.sheets.reduce((E,K)=>E!==null?E:K.index===b?K:E,null);C?(l(C),d(C.index),m(C.repRange!==""),x.current&&(x.current.value=C.repRange),u.current&&(u.current.value=C.prefixes),c.current&&(c.current.value=C.oneTimeTemplate),w.current&&(w.current.value=C.iterationTemplate),_.current&&(_.current.value=C.additionalImportUrls),D.current&&(D.current.value=C.oneTimeImportSparql),R.current&&(R.current.value=C.iterationImportSparql),I.current&&(I.current.value=C.rdfPodUrl)):console.log(`GAHA: There is no sheet: index=${b}???`)},j=()=>{const b=se();if(b.sheetIdx!==a){alert("設定中のシートと、現在アクティブなシートが異なっているので取り込みを中止します。");return}if(b.range.indexOf(":")<0){alert("範囲が選択されていなかったので取り込みを中止します。");return}x.current&&(x.current.value=b.range),f(!0)},L=b=>{u.current&&(u.current.value.endsWith(`
`)||(u.current.value+=`
`),u.current.value+=b.target.textContent,f(!0),o(!1))},q=()=>{x.current&&(x.current.value===""?m(!1):m(!0),f(!0))},z=()=>{f(!0)},re=()=>{v.current&&(t.fileSettings.podUrl=v.current.value),x.current&&(r.repRange=x.current.value),u.current&&(r.prefixes=u.current.value),c.current&&(r.oneTimeTemplate=c.current.value),w.current&&(r.iterationTemplate=w.current.value),_.current&&(r.additionalImportUrls=_.current.value),D.current&&(r.oneTimeImportSparql=D.current.value),R.current&&(r.iterationImportSparql=R.current.value),I.current&&(r.rdfPodUrl=I.current.value),n(t),f(!1),alert("シートの設定を変更しました。")};return e.jsxs("div",{className:T.allSettings,children:[e.jsx("h1",{children:"エクスポート"}),e.jsx("div",{className:T.selectedSheetDiv,children:e.jsxs("label",{children:["設定するシート:",e.jsx("select",{value:a,onChange:b=>S(b.target.value),name:"selectedSheet",children:t.sheets.map(b=>e.jsx("option",{value:b.index,children:b.name},b.index))}),e.jsx("span",{style:{color:h?"red":"black"},children:h?"シートのエクスポート設定の変更あり":"シートのエクスポート設定の変更なし"}),e.jsx("button",{className:T.saveBtn,onClick:re,disabled:!h,children:"設定変更"}),e.jsx("button",{onClick:()=>p(!0),children:"エクスポート"})]})}),e.jsxs("div",{className:T.repRangeDiv,children:["反復範囲(インポートとの共有設定):",e.jsx("input",{ref:x,type:"text",defaultValue:r.repRange,onChange:q}),e.jsx("button",{type:"button",onClick:j,children:"選択範囲から取り込み"})]}),e.jsxs("div",{className:T.prefixDiv,children:[e.jsxs("div",{children:[e.jsx("h4",{children:"プレフィックス"}),e.jsx("span",{className:T.glue}),e.jsx("button",{id:"importPrefixBtn",className:T.importPrefixBtn,onClick:()=>o(!0),children:"プレフィックスを取り込む"})]}),e.jsxs(O,{isVisible:s,onClose:()=>o(!1),children:[e.jsx("p",{children:"取り込みたいプレフィックスをクリックして下さい。"}),P.prefixes.split(`
`).map(b=>e.jsx("p",{onClick:L,children:b}))]}),e.jsx("textarea",{ref:u,defaultValue:r.prefixes,className:T.prefixTA,onChange:z})]}),e.jsxs("div",{children:[e.jsx("h4",{children:"1回テンプレート"}),e.jsx("textarea",{ref:c,defaultValue:r.oneTimeTemplate,className:T.oneTimeTemplateTA,onChange:z})]}),e.jsxs("div",{children:[e.jsx("h4",{children:"反復テンプレート"}),e.jsx("textarea",{ref:w,defaultValue:r.iterationTemplate,className:T.iterationTemplateTA,onChange:z,disabled:!y})]}),e.jsxs("div",{className:T.pathDiv,children:[e.jsx("label",{htmlFor:"rdfURLTB",children:"RDF URL(インポートとの共通設定)"}),e.jsx("input",{ref:I,type:"text",defaultValue:r.rdfPodUrl,onChange:z})]}),e.jsx(O,{isVisible:g,onClose:()=>p(!1),children:e.jsx(nt,{settings:t,onExported:()=>p(!1)})})]})},rt=({settings:t,onImported:n})=>{const s=i.useRef(null);i.useEffect(()=>{const l=t.sheets.reduce((a,d)=>a!==null?a:d.status===1?d.rdfPodUrl:a,null);l&&s.current&&(s.current.value=l)},[t]);const o=()=>{Re(),n()},r=()=>{if(!s.current)return;const l=s.current.value;Ie(l),n()};return e.jsxs(e.Fragment,{children:[e.jsx("h4",{children:"ImportComponent"}),e.jsx("div",{children:e.jsx("button",{type:"button",onClick:o,children:"import from local"})}),e.jsxs("div",{style:{display:"flex",margin:"1em 0"},children:[e.jsx("button",{type:"button",onClick:r,children:"import from pod"}),e.jsx("input",{type:"text",ref:s,style:{flexGrow:1}})]})]})},ot=({settings:t,onChange:n})=>{const[s,o]=i.useState(t.sheets[0]),[r,l]=i.useState("iTha4zah"),[a,d]=i.useState(!1),[h,f]=i.useState(!1),y=i.useRef(null),m=i.useRef(null),g=i.useRef(null),p=i.useRef(null),v=i.useRef(null),x=i.useRef(null),u=i.useRef(null),c=i.useRef(null),w=i.useRef(null);i.useEffect(()=>{const S=t.sheets.reduce((j,L)=>j!==null?j:L.status===1?L.index:j,null);_(S)},[t]);const _=S=>{if(a&&!window.confirm("設定を保存せずにシートを変更しますか？"))return;d(!1);const j=t.sheets.reduce((L,q)=>L!==null?L:q.index===S?q:L,null);j?(o(j),l(j.index),m.current&&(m.current.value=j.repRange),g.current&&(g.current.value=j.prefixes),p.current&&(p.current.value=j.oneTimeTemplate),v.current&&(v.current.value=j.iterationTemplate),x.current&&(x.current.value=j.additionalImportUrls),u.current&&(u.current.value=j.oneTimeImportSparql),c.current&&(c.current.value=j.iterationImportSparql),w.current&&(w.current.value=j.rdfPodUrl)):console.log(`GAHA: There is no sheet: index=${S}???`)},D=()=>{const S=se();if(S.sheetIdx!==r){alert("設定中のシートと、現在アクティブなシートが異なっているので取り込みを中止します。");return}if(S.range.indexOf(":")<0){alert("範囲が選択されていなかったので取り込みを中止します。");return}m.current&&(m.current.value=S.range),d(!0)},R=()=>{m.current&&d(!0)},I=()=>{d(!0)},P=()=>{y.current&&(t.fileSettings.podUrl=y.current.value),m.current&&(s.repRange=m.current.value),g.current&&(s.prefixes=g.current.value),p.current&&(s.oneTimeTemplate=p.current.value),v.current&&(s.iterationTemplate=v.current.value),x.current&&(s.additionalImportUrls=x.current.value),u.current&&(s.oneTimeImportSparql=u.current.value),c.current&&(s.iterationImportSparql=c.current.value),w.current&&(s.rdfPodUrl=w.current.value),n(t),d(!1),alert("シートの設定を変更しました。")};return e.jsxs("div",{className:T.allSettings,children:[e.jsx("h1",{children:"インポート"}),e.jsx("div",{className:T.selectedSheetDiv,children:e.jsxs("label",{children:["設定するシート:",e.jsx("select",{value:r,onChange:S=>_(S.target.value),name:"selectedSheet",children:t.sheets.map(S=>e.jsx("option",{value:S.index,children:S.name},S.index))}),e.jsx("span",{style:{color:a?"red":"black"},children:a?"シートのインポート設定の変更あり":"シートのインポート設定の変更なし"}),e.jsx("button",{className:T.saveBtn,onClick:P,disabled:!a,children:"設定変更"}),e.jsx("button",{onClick:()=>f(!0),children:"インポート"})]})}),e.jsxs("div",{className:T.repRangeDiv,children:["反復範囲(エクスポートとの共通設定):",e.jsx("input",{ref:m,type:"text",defaultValue:s.repRange,onChange:R}),e.jsx("button",{type:"button",onClick:D,children:"選択範囲から取り込み"})]}),e.jsxs("div",{children:[e.jsx("h4",{children:"追加インポートRDFのURL"}),e.jsx("textarea",{ref:x,defaultValue:s.additionalImportUrls,className:T.additionalImportUrlsTA,onChange:I})]}),e.jsxs("div",{children:[e.jsx("h4",{children:"1回インポートSPARQL"}),e.jsx("textarea",{ref:u,defaultValue:s.oneTimeImportSparql,className:T.oneTimeImportSparqlTA,onChange:I})]}),e.jsxs("div",{children:[e.jsx("h4",{children:"反復インポートSPARQL"}),e.jsx("textarea",{ref:c,defaultValue:s.iterationImportSparql,className:T.iterationImportSparqlTA,onChange:I})]}),e.jsxs("div",{className:T.pathDiv,children:[e.jsx("label",{htmlFor:"rdfURLTB",children:"RDF URL(エクスポートとの共通設定)"}),e.jsx("input",{ref:w,type:"text",defaultValue:s.rdfPodUrl,onChange:I})]}),e.jsx(O,{isVisible:h,onClose:()=>f(!1),children:e.jsx(rt,{settings:t,onImported:()=>f(!1)})})]})},lt="_allBookSettings_qbonv_3",it="_title_qbonv_17",at="_filePathDiv_qbonv_22",ct="_saveBtn_qbonv_31",J={allBookSettings:lt,title:it,filePathDiv:at,saveBtn:ct},ut=({settings:t,onChange:n})=>{const[s,o]=i.useState(!1),r=i.useRef(null);i.useEffect(()=>{},[t]);const l=()=>{o(!0)},a=()=>{r.current&&(t.fileSettings.podUrl=r.current.value),n(t),o(!1),alert("シートの設定を変更しました。")};return e.jsx("div",{className:J.allBookSettings,children:e.jsxs("div",{className:J.title,children:[e.jsx("h3",{children:"Book設定"}),e.jsx("p",{children:"Excelで言うところのBook（つまり複数のシートを含むファイル全体）の設定。"}),e.jsxs("p",{children:[e.jsx("span",{style:{color:s?"red":"black"},children:s?"Book設定修正あり":"Book設定修正なし"}),e.jsx("button",{className:J.saveBtn,onClick:a,disabled:!s,children:"設定変更"})]}),e.jsxs("div",{className:J.filePathDiv,children:[e.jsx("label",{htmlFor:"fileURLTB",children:"ファイルURL"}),e.jsx("input",{ref:r,type:"text",defaultValue:t.fileSettings.podUrl,onChange:l})]})]})})},dt="_allAppSettings_plc8o_3",pt="_prefixesDiv_plc8o_10",ht="_prefixesTA_plc8o_15",ft="_idpDiv_plc8o_20",mt="_idpTB_plc8o_26",$={allAppSettings:dt,prefixesDiv:pt,prefixesTA:ht,idpDiv:ft,idpTB:mt},xt=()=>{const[t,n]=i.useState(!1),[s,o]=i.useState([]),{appData:r,updateAppData:l}=Q(),a=i.useRef(null),d=i.useRef(null),h=i.useRef(null),f=i.useRef(null),y=i.useRef(null),m=i.useRef(null);i.useEffect(()=>{o([...r.clientIDs])},[r]);const g=()=>{n(!0)},p=()=>{const u=s.filter(D=>{var R;return D.name!==((R=h.current)==null?void 0:R.value)}),c=y.current?y.current.value:"undefined",w=m.current?m.current.value:"undefined",_={name:h.current?h.current.value:"undefined",provider:f.current?f.current.value:"undefined",id:btoa(c),secret:btoa(w)};o([...u,_]),n(!0)},v=()=>{o(s.filter(u=>{var c;return u.name!==((c=h.current)==null?void 0:c.value)})),n(!0)},x=()=>{var c,w;const u={prefixes:(c=a.current)==null?void 0:c.value,idp:(w=d.current)==null?void 0:w.value,clientIDs:s};l(u),n(!1),alert("アプリ設定を保存しました。")};return e.jsxs("div",{className:$.allAppSettings,children:[e.jsx("h2",{children:"AppSettings"}),e.jsx("p",{children:"編集中のファイルではなくアプリの設定をします。"}),e.jsxs("p",{children:[e.jsx("span",{style:{color:t?"red":"black"},children:t?"App設定修正あり":"App設定修正なし"}),e.jsx("button",{onClick:x,children:"設定変更"})]}),e.jsx("h4",{children:"プレフィックス"}),e.jsx("div",{className:$.prefixesDiv,children:e.jsx("textarea",{ref:a,className:$.prefixesTA,defaultValue:r.prefixes,onChange:g})}),e.jsx("h4",{children:"デフォルトのログイン場所"}),e.jsx("div",{className:$.idpDiv,children:e.jsx("input",{ref:d,className:$.idpTB,defaultValue:r.idp,onChange:g})}),e.jsx("h4",{children:"クライアントシークレットが必要な場合"}),e.jsx("h5",{children:"クライアント設定の追加"}),e.jsxs("p",{children:[e.jsxs("label",{children:["name:",e.jsx("input",{type:"text",ref:h})]}),e.jsxs("label",{children:["provider:",e.jsx("input",{type:"text",ref:f})]}),e.jsxs("label",{children:["id:",e.jsx("input",{type:"text",ref:y})]}),e.jsxs("label",{children:["secret:",e.jsx("input",{type:"text",ref:m})]}),e.jsx("button",{onClick:p,children:"追加"})]}),e.jsx("h5",{children:"クライアント設定の削除"}),e.jsxs("p",{children:[e.jsx("select",{children:s.map((u,c)=>e.jsx("option",{value:u.name,children:u.name},c))}),e.jsx("button",{onClick:v,disabled:s.length===0,children:"削除"})]})]})},gt=({settings:t,onLoaded:n})=>{const s=i.useRef(null);i.useEffect(()=>{const l=t.fileSettings.podUrl;l&&s.current&&(s.current.value=l)},[t]);const o=async()=>{await Te(),n()},r=async()=>{if(!s.current)return;const l=s.current.value;await be(l),n()};return e.jsxs(e.Fragment,{children:[e.jsx("h4",{children:"LoadComponent"}),e.jsx("div",{children:e.jsx("button",{type:"button",onClick:o,children:"load from local"})}),e.jsxs("div",{style:{display:"flex",margin:"1em 0"},children:[e.jsx("button",{type:"button",onClick:r,children:"load from pod"}),e.jsx("input",{type:"text",ref:s,style:{flexGrow:1}})]})]})},St=({settings:t,onSaved:n})=>{const s=i.useRef(null);i.useEffect(()=>{const l=t.fileSettings.podUrl;l&&s.current&&(s.current.value=l)},[t]);const o=()=>{we(),n()},r=()=>{if(!s.current)return;const l=s.current.value;Ce(l),n()};return e.jsxs(e.Fragment,{children:[e.jsx("h4",{children:"SaveComponent"}),e.jsx("div",{children:e.jsx("button",{type:"button",onClick:o,children:"save to local"})}),e.jsxs("div",{style:{display:"flex",margin:"1em 0"},children:[e.jsx("button",{type:"button",onClick:r,children:"save to pod"}),e.jsx("input",{type:"text",ref:s,style:{flexGrow:1}})]})]})},vt=()=>{const[t,n]=i.useState(k.settings),[s,o]=i.useState(!0),[r,l]=i.useState(!1),[a,d]=i.useState(!1),[h,f]=i.useState(!1),[y,m]=i.useState(!1),[g,p]=i.useState(!1),[v,x]=i.useState(!1),u=c=>{["export","import"].includes(c)&&n(U()),["load","save","help","about"].includes(c)||(o(c==="sheets"),l(c==="export"),d(c==="import"),f(c==="bookSettings"),m(c==="appSettings")),c==="load"?p(!0):c==="save"?x(!0):c==="help"?ke():c==="about"&&De()};return e.jsxs(ce,{children:[e.jsxs("header",{children:[e.jsx(Oe,{onSelect:u}),e.jsxs("div",{className:Le.headerPanels,children:[e.jsx(Fe,{}),e.jsxs("div",{children:[e.jsx("button",{onClick:()=>u("sheets"),style:{background:s?"red":"white"},children:"Sheets"}),e.jsx("button",{onClick:()=>u("load"),style:{background:"white"},children:"Load"}),e.jsx("button",{onClick:()=>u("save"),style:{background:"white"},children:"Save"}),e.jsx("button",{onClick:()=>u("export"),style:{background:r?"red":"white"},children:"Export"}),e.jsx("button",{onClick:()=>u("import"),style:{background:a?"red":"white"},children:"Import"}),e.jsx("button",{onClick:()=>u("bookSettings"),style:{background:h?"red":"white"},children:"BookSettings"}),e.jsx("button",{onClick:()=>u("appSettings"),style:{background:y?"red":"white"},children:"AppSettings"})]})]})]}),e.jsxs("main",{children:[e.jsx($e,{isVisible:s,children:e.jsx(qe,{onLoad:c=>n(c)})}),r===!0?e.jsx(st,{settings:t,onChange:c=>n(c)}):null,a===!0?e.jsx(ot,{settings:t,onChange:c=>n(c)}):null,h===!0?e.jsx(ut,{settings:t,onChange:c=>n(c)}):null,y===!0?e.jsx(xt,{}):null]}),e.jsx(O,{isVisible:g,onClose:()=>p(!1),children:e.jsx(gt,{settings:t,onLoaded:()=>{p(!1),n(k.settings)}})}),e.jsx(O,{isVisible:v,onClose:()=>x(!1),children:e.jsx(St,{settings:t,onSaved:()=>x(!1)})})]})};async function jt(){await je();const t=window;let n=null;t.launchQueue&&t.launchQueue.setConsumer&&t.launchQueue.setConsumer(async s=>{n||s.files.length&&(n=new Promise(async o=>{const a=await(await s.files[0].getFile()).text();localStorage.setItem("RDFSheetTempFile",a),o()}))}),n&&await n,oe.createRoot(document.getElementById("root")).render(e.jsx(i.StrictMode,{children:e.jsx(vt,{})}))}jt();
