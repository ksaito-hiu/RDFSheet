import{r as a,j as e,a as re}from"./react-BL4LEYSH.js";import{i as le,N as ie,a as ae}from"./vendor-C8VTLH0V.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function i(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerPolicy&&(l.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?l.credentials="include":n.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(n){if(n.ep)return;n.ep=!0;const l=i(n);fetch(n.href,l)}})();const{handleIncomingRedirect:oe,login:ce,logout:ue,fetch:de}=window.solidClientAuthentication,H=de;async function pe(t,s,i){return new Promise((r,n)=>{const l={format:"text/turtle",baseIRI:i};new ae(l).parse(t,(h,m,p)=>{h?n(h):m?s.addQuad(m):r(p)})})}const fe=async t=>{await ce({oidcIssuer:t})},he=()=>{ue()};let B=null;async function me(){const t=await oe();t&&t.isLoggedIn?t.webId&&(B=t.webId):B=null}const D=window.luckysheet,N={settings:{sheets:[],fileSettings:{podUrl:""}}},xe=()=>({index:"iTha4zah",name:"??????????",status:0,repRange:"",prefixes:"",oneTimeTemplate:"",iterationTemplate:"",additionalImportUrls:"",oneTimeImportSparql:"",iterationImportSparql:"",rdfPodUrl:"https://example.org/my_pod/rdfsheet.ttl"}),Z=()=>({sheets:[],fileSettings:{podUrl:"https://example.org/my_pod/rdfsheet.rdfs"}}),E=()=>{const t=D.getAllSheets(),s=N.settings.sheets,i=[];return t.forEach(r=>{const n=s.reduce((l,u)=>l||(u.index===r.index.toString()?u:l),null);if(n!==null)n.name=r.name,n.status=Number(r.status),i.push(n);else{const l=xe();l.index=r.index.toString(),l.name=r.name,l.status=Number(r.status),i.push(l)}}),N.settings.sheets=i,N.settings};function O(t){return t instanceof Error?t.message:String(t)}function W(t){const s={container:"luckysheet",data:void 0,showinfobar:!1,showtoolbar:!0,sheetFormulaBar:!0,showsheetbar:!0,showstatisticBar:!0};t.luckysheetfile&&(s.data=t.luckysheetfile),t.settings&&(N.settings=t.settings),D.create(s),E()}async function ge(){try{const t={types:[{description:"RDFSheet file",accept:{"application/x-rdfsheet+json":[".rdfs"]}}]},[s]=await window.showOpenFilePicker(t),r=await(await s.getFile()).text(),n=JSON.parse(r);W(n)}catch(t){alert(`ファイルは開かれませんでした。${O(t)}`)}}async function ve(t){try{const i=await(await H(t)).json();W(i)}catch(s){alert(`ファイルの読み込みに失敗しました。${O(s)}`)}}async function Se(){try{const t={luckysheetfile:D.getluckysheetfile(),settings:JSON.parse(JSON.stringify(N.settings))},s={suggestedName:"rdfsheetfile.rdfs",types:[{description:"RDFSheet file",accept:{"application/x-rdfsheet+json":[".rdfs"]}}]},r=await(await window.showSaveFilePicker(s)).createWritable();await r.write(JSON.stringify(t)),await r.close()}catch(t){alert(`ファイルは保存されませんでした。${O(t)}`)}}async function je(t){try{const s={luckysheetfile:D.getluckysheetfile(),settings:JSON.parse(JSON.stringify(N.settings))};await H(t,{method:"PUT",headers:{"Content-Type":"application/x-rdfsheet+json"},body:JSON.stringify(s)}),alert("ファイルを保存しました。")}catch(s){alert(`ファイルの保存に失敗しました。${O(s)}`)}}async function ee(t,s){const i=N.settings.sheets.reduce((n,l,u)=>n!=-1?n:l.status===1?u:n,-1),r=N.settings.sheets[i];if(r)try{const n=new le.QueryEngine,l=new ie;await pe(t,l,s);const u=[l];for(const S of r.additionalImportUrls.split(`
`))S!==""&&u.push(S);const h=`BASE <${s}>
`+r.oneTimeImportSparql,p=await(await n.queryBindings(h,{sources:u})).toArray(),w={isRefresh:!0};if(p.length>=1)for(const[S,T]of p[0]){console.log(`GAHA: ${S.value}<=${T.value}`);const o=k(S.value);D.setCellValue(o.row,o.col,T.value,w)}else alert("The result of oneTimeSparql is empty.");if(r.repRange!==""){const S=r.repRange.split(":")[0],T=r.repRange.split(":")[1],o=k(S),f=k(T),g=`BASE <${s}>
`+r.iterationImportSparql,j=await n.query(g,{sources:u});if(j.resultType!=="bindings")throw new Error("iterationImportSparql is not SELECT query.");const b=await j.metadata(),y=await(await j.execute()).toArray();alert(`The result count of iterationImportSparql is ${y.length}.`);let A=b.variables;for(let v=o.row+1;v<=f.row+1;v++){const P=y.shift();if(P!=null)for(const[U,L]of P){const F=k(`${U.value}${v}`);D.setCellValue(F.row,F.col,L.value,w)}else for(const U of A){const L=k(`${U.value}${v}`);D.setCellValue(L.row,L.col,"",w)}}}D.refreshFormula()}catch{throw new Error("インポートエラー")}else return alert("アクティブなシートがありません？！"),null}async function Te(){E();try{const t={types:[{description:"Turtle(RDF) file",accept:{"text/turtle":[".ttl"]}}]},[s]=await window.showOpenFilePicker(t),i=await s.getFile(),r=await i.text(),n=`file:///C:/Users/me/RDFSheet/${i.name}`;await ee(r,n)}catch(t){alert(`ファイルは開かれませんでした。${O(t)}`)}}async function ye(t){E();try{const i=await(await H(t)).text();await ee(i,t)}catch(s){alert(`ファイルの読み込みに失敗しました。${O(s)}`)}}function te(){const t=N.settings.sheets.reduce((i,r,n)=>i!=-1?i:r.status===1?n:i,-1),s=N.settings.sheets[t];if(s){const i={type:"v",order:t};let r="";r+=s.prefixes;let n=s.oneTimeTemplate.matchAll(/<<([A-Za-z]+)(\d+)>>/g),l=[...n].map(m=>`${m[1]}${m[2]}`),u={};for(const m of l){const p=k(m);u[m]=D.getCellValue(p.row,p.col,i)}let h=s.oneTimeTemplate;for(const m of Object.keys(u))h=h.replace(`<<${m}>>`,u[m]);if(r+=h,s.repRange!==""){n=s.oneTimeTemplate.matchAll(/<<([A-Za-z]+)(\d+)>>/g),l=[...n].map(o=>`${o[1]}${o[2]}`),u={};for(const o of l){const f=k(o);u[o]=D.getCellValue(f.row,f.col,i)}h=s.iterationTemplate;for(const o of Object.keys(u))h=h.replace(`<<${o}>>`,u[o]);n=s.iterationTemplate.matchAll(/<<([A-Za-z]+)>>/g),l=[...n].map(o=>o[1]);const m=s.repRange.split(":")[0],p=s.repRange.split(":")[1],w=k(m),S=k(p);let T=0;e:for(let o=w.row;o<=S.row;o++){let f=h;u={};for(const g of l){const j=ne(g);if(u[g]=D.getCellValue(o,j,i),u[g]==null){u={},T++;continue e}}for(const g of Object.keys(u))f=f.replace(`<<${g}>>`,u[g]);r+=f}T!==0&&alert(`繰り返し処理中に必要なデータが無かったためにとばした行が${T}行ありました。`)}return r}else return alert("アクティブなシートがありません？！"),null}async function be(){E();const t=te();try{const s={suggestedName:"rdfsheetfile.ttl",types:[{description:"Turtle(RDF) file",accept:{"text/turtle":[".ttl"]}}]},r=await(await window.showSaveFilePicker(s)).createWritable();await r.write(t),await r.close()}catch(s){alert(`RDFファイルは保存されませんでした。${O(s)}`)}}async function Re(t){E();const s=te();try{await H(t,{method:"PUT",headers:{"Content-Type":"text/turtle"},body:s}),alert("RDFをエクスポートしました。")}catch(i){alert(`RDFのエクスポートに失敗しました。${O(i)}`)}}function Ae(){window.open("https://github.com/ksaito-hiu/RDFSheet/tree/main/help","help","width=600,height=400,left=100,top=100,resizable=yes,scrollbars=yes")}function Ce(){window.open("https://github.com/ksaito-hiu/RDFSheet/","about","width=600,height=400,left=100,top=100,resizable=yes,scrollbars=yes")}const ne=t=>{const s=t.toUpperCase();let i=0;for(let r=s.length-1;r>=0;r--)i*=25,i+="ABCDEFGHIJKLMNOPQRSTUVWXYZ".indexOf(s.charAt(r));return i},k=t=>{const s=t.match(/^([A-Za-z]+)(\d+)$/i);if(!s)throw new Error("無効なセル式です。");const[,i,r]=s,n=ne(i),l=Number(r)-1;return{col:n,row:l}},M=()=>{const t=D.getRangeAxis(),s=D.getAllSheets();let i;for(const r of s)Number(r.status)===1&&(i=r.index.toString());return{range:t[0],sheetIdx:i}},Ie="_headerPanels_ymhxh_8",_e={headerPanels:Ie},K="RDFSheetLocalStorageKey",X=window.localStorage,Y={prefixes:"@prefix dc: <http://purl.org/dc/terms/> .",idp:"https://solidcommunity.net"},se=a.createContext(void 0),we=({children:t})=>{const[s,i]=a.useState(()=>{const n=X.getItem(K);if(n)try{const l=JSON.parse(n);if(l&&typeof l=="object")return{...Y,...l}}catch(l){return console.warn("設定の読み込みに失敗しました。",l),console.warn("設定を初期化します。"),Y}});a.useEffect(()=>{X.setItem(K,JSON.stringify(s))},[s]);const r=n=>{i(l=>({...l,...n}))};return e.jsx(se.Provider,{value:{appData:s,updateAppData:r},children:t})},Q=()=>{const t=a.useContext(se);if(!t)throw new Error("useAppData must be used within a AppDataProvider");return t},$=({isVisible:t,onClose:s,children:i})=>{const r=a.useRef(null),n=()=>{s()};return a.useEffect(()=>{const l=r.current;l&&(t?l.open||(l.showModal(),l.addEventListener("close",n)):l.open&&(l.removeEventListener("close",n),l.close()))},[t]),t?e.jsxs("dialog",{ref:r,style:{zIndex:3e3,width:"80%"},children:[e.jsx("div",{style:{border:"black"},children:i}),e.jsx("button",{onClick:()=>{var l;return(l=r.current)==null?void 0:l.close()},children:"close"})]}):null},De=()=>{const{appData:t,updateAppData:s}=Q(),[i,r]=a.useState(B!==null),[n,l]=a.useState(B===null?"not logged in":B),[u,h]=a.useState("https://solidcommunity.net"),[m,p]=a.useState(!1);a.useEffect(()=>{const o=t&&t.idp?t.idp:"https://solidcommunity.net";h(o)},[t]);const w=o=>{h(o.target.value)},S=async()=>{s({idp:u}),await fe(u),l(B===null?"not logged in":B),p(!1)},T=()=>{he(),r(!1),l("not logged in"),p(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("button",{onClick:()=>{p(!0)},children:i?"logout or relogin":"login"}),e.jsxs("span",{style:{marginLeft:"1em"},children:["WebID: ",n]})]}),e.jsxs($,{isVisible:m,onClose:()=>p(!1),children:[e.jsx("h4",{children:"ログイン・ログアウト"}),e.jsx("p",{children:"ログインしたい時はidpに認証サーバを直接入力するか、代表的な認証サーバのボタンを押し「Login」ボタンを押して下さい。ログアウトしたい時は「Logout」ボタンを押して下さい。"}),e.jsxs("div",{style:{display:"flex"},children:["idp: ",e.jsx("input",{type:"text",value:u,onChange:w,style:{flexGrow:1}}),e.jsx("button",{onClick:S,children:"Login"})]}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("button",{onClick:()=>{h("https://solidcommunity.net")},children:"Solid Community"})}),e.jsx("li",{children:e.jsx("button",{onClick:()=>{h("https://solidweb.me")},children:"solidweb.me"})}),e.jsx("li",{children:e.jsx("button",{onClick:()=>{h("https://solidweb.org")},children:"solidweb.org"})}),e.jsx("li",{children:e.jsx("button",{onClick:()=>{h("https://login.inrupt.com")},children:"Inrupt Identity Provider"})})]}),e.jsx("p",{children:e.jsx("button",{onClick:T,children:"Logout"})})]})]})},Ne="_menu_div_1540h_2",Pe="_hamburger_1540h_9",Le="_menu_close_1540h_23",Ue="_menu_open_1540h_35",G={menu_div:Ne,hamburger:Pe,menu_close:Le,menu_open:Ue},ke=({onSelect:t})=>{const[s,i]=a.useState(!1),r=n=>{i(!1),t(n)};return e.jsxs("div",{className:G.menu_div,children:[e.jsx("button",{className:G.hamburger,onClick:()=>i(!s),children:s?"×":"☰"}),e.jsx("nav",{className:s?G.menu_open:G.menu_close,children:e.jsxs("ul",{children:[e.jsxs("li",{children:["画面切り替え",e.jsxs("ul",{children:[e.jsx("li",{onClick:()=>{r("sheets")},children:"Sheet"}),e.jsx("li",{onClick:()=>{r("settings")},children:"Settings"}),e.jsx("li",{onClick:()=>{r("appSettings")},children:"AppSettings"})]})]}),e.jsxs("li",{children:["ファイル",e.jsxs("ul",{children:[e.jsx("li",{onClick:()=>{r("load")},children:"Load"}),e.jsx("li",{onClick:()=>{r("save")},children:"Save"}),e.jsx("li",{onClick:()=>{r("import")},children:"Import"}),e.jsx("li",{onClick:()=>{r("export")},children:"Export"})]})]}),e.jsxs("li",{children:["その他",e.jsxs("ul",{children:[e.jsx("li",{onClick:()=>{r("help")},children:"Help"}),e.jsx("li",{onClick:()=>{r("about")},children:"About"})]})]})]})})]})},Fe=({isVisible:t,children:s})=>(a.useEffect(()=>{t&&window.luckysheet.resize()},[t]),e.jsx("div",{style:{display:t?"block":"none",width:"100vw",height:"100%"},children:s})),qe=({onLoad:t})=>{const s=a.useRef(!1);a.useEffect(()=>{if(s.current)return;s.current=!0;let r;try{const n=localStorage.getItem("RDFSheetTempFile");n?(r=JSON.parse(n),localStorage.removeItem("RDFSheetTempFile")):r={luckysheetfile:void 0,settings:Z()}}catch{r={luckysheetfile:void 0,settings:Z()}}W(r),E(),t(r.settings)},[]);const i={margin:"0px",padding:"0px",width:"100%",height:"100%"};return e.jsx("div",{id:"luckysheet",style:i})},$e="_allSettings_6bzdr_3",Oe="_title_6bzdr_22",Be="_filePathDiv_6bzdr_27",Ee="_selectedSheetDiv_6bzdr_36",ze="_saveBtn_6bzdr_45",Ve="_repRangeDiv_6bzdr_49",Je="_prefixDiv_6bzdr_53",Qe="_glue_6bzdr_57",Ge="_prefixTA_6bzdr_61",He="_importPrefixBtn_6bzdr_68",We="_oneTimeTemplateTA_6bzdr_72",Me="_iterationTemplateTA_6bzdr_79",Ze="_additionalImportUrlsTA_6bzdr_86",Ke="_oneTimeImportSparqlTA_6bzdr_93",Xe="_iterationImportSparqlTA_6bzdr_100",Ye="_pathDiv_6bzdr_107",x={allSettings:$e,title:Oe,filePathDiv:Be,selectedSheetDiv:Ee,saveBtn:ze,repRangeDiv:Ve,prefixDiv:Je,glue:Qe,prefixTA:Ge,importPrefixBtn:He,oneTimeTemplateTA:We,iterationTemplateTA:Me,additionalImportUrlsTA:Ze,oneTimeImportSparqlTA:Ke,iterationImportSparqlTA:Xe,pathDiv:Ye},et=({settings:t,onChange:s})=>{const[i,r]=a.useState(!1),[n,l]=a.useState(t.sheets[0]),[u,h]=a.useState("iTha4zah"),[m,p]=a.useState(!1),[w,S]=a.useState(!1),T=a.useRef(null),o=a.useRef(null),f=a.useRef(null),g=a.useRef(null),j=a.useRef(null),b=a.useRef(null),C=a.useRef(null),y=a.useRef(null),A=a.useRef(null),{appData:v}=Q();a.useEffect(()=>{const c=t.sheets.reduce((d,I)=>d!==null?d:I.status===1?I.index:d,null);P(c)},[t]);const P=c=>{if(m&&!window.confirm("設定を保存せずにシートを変更しますか？"))return;p(!1);const d=t.sheets.reduce((I,q)=>I!==null?I:q.index===c?q:I,null);d?(l(d),h(d.index),S(d.repRange!==""),o.current&&(o.current.value=d.repRange),f.current&&(f.current.value=d.prefixes),g.current&&(g.current.value=d.oneTimeTemplate),j.current&&(j.current.value=d.iterationTemplate),b.current&&(b.current.value=d.additionalImportUrls),C.current&&(C.current.value=d.oneTimeImportSparql),y.current&&(y.current.value=d.iterationImportSparql),A.current&&(A.current.value=d.rdfPodUrl)):console.log(`GAHA: There is no sheet: index=${c}???`)},U=()=>{const c=M();if(c.sheetIdx!==u){alert("設定中のシートと、現在アクティブなシートが異なっているので取り込みを中止します。");return}if(c.range.indexOf(":")<0){alert("範囲が選択されていなかったので取り込みを中止します。");return}o.current&&(o.current.value=c.range),p(!0)},L=c=>{f.current&&(f.current.value.endsWith(`
`)||(f.current.value+=`
`),f.current.value+=c.target.textContent,p(!0),r(!1))},F=()=>{o.current&&(o.current.value===""?S(!1):S(!0),p(!0))},z=()=>{p(!0)},R=()=>{p(!0)},V=()=>{T.current&&(t.fileSettings.podUrl=T.current.value),o.current&&(n.repRange=o.current.value),f.current&&(n.prefixes=f.current.value),g.current&&(n.oneTimeTemplate=g.current.value),j.current&&(n.iterationTemplate=j.current.value),b.current&&(n.additionalImportUrls=b.current.value),C.current&&(n.oneTimeImportSparql=C.current.value),y.current&&(n.iterationImportSparql=y.current.value),A.current&&(n.rdfPodUrl=A.current.value),s(t),p(!1),alert("シートの設定を変更しました。")};return e.jsxs("div",{className:x.allSettings,children:[e.jsxs("div",{className:x.title,children:[e.jsx("h3",{children:"ファイル設定"}),e.jsxs("div",{className:x.filePathDiv,children:[e.jsx("label",{htmlFor:"fileURLTB",children:"ファイルURL"}),e.jsx("input",{ref:T,type:"text",defaultValue:t.fileSettings.podUrl,onChange:z})]})]}),e.jsx("div",{className:x.selectedSheetDiv,children:e.jsxs("label",{children:["設定するシート:",e.jsx("select",{value:u,onChange:c=>P(c.target.value),name:"selectedSheet",children:t.sheets.map(c=>e.jsx("option",{value:c.index,children:c.name},c.index))}),e.jsx("span",{style:{color:m?"red":"black"},children:m?"シート設定修正あり":"シート設定修正なし"}),e.jsx("button",{className:x.saveBtn,onClick:V,disabled:!m,children:"設定変更"})]})}),e.jsxs("div",{className:x.repRangeDiv,children:["反復範囲:",e.jsx("input",{ref:o,type:"text",defaultValue:n.repRange,onChange:F}),e.jsx("button",{type:"button",onClick:U,children:"選択範囲から取り込み"})]}),e.jsxs("div",{className:x.prefixDiv,children:[e.jsxs("div",{children:[e.jsx("h4",{children:"プレフィックス"}),e.jsx("span",{className:x.glue}),e.jsx("button",{id:"importPrefixBtn",className:x.importPrefixBtn,onClick:()=>r(!0),children:"プレフィックスを取り込む"})]}),e.jsxs($,{isVisible:i,onClose:()=>r(!1),children:[e.jsx("p",{children:"取り込みたいプレフィックスをクリックして下さい。"}),v.prefixes.split(`
`).map(c=>e.jsx("p",{onClick:L,children:c}))]}),e.jsx("textarea",{ref:f,defaultValue:n.prefixes,className:x.prefixTA,onChange:R})]}),e.jsxs("div",{children:[e.jsx("h4",{children:"1回テンプレート"}),e.jsx("textarea",{ref:g,defaultValue:n.oneTimeTemplate,className:x.oneTimeTemplateTA,onChange:R})]}),e.jsxs("div",{children:[e.jsx("h4",{children:"反復テンプレート"}),e.jsx("textarea",{ref:j,defaultValue:n.iterationTemplate,className:x.iterationTemplateTA,onChange:R,disabled:!w})]}),e.jsxs("div",{children:[e.jsx("h4",{children:"追加インポートRDFのURL"}),e.jsx("textarea",{ref:b,defaultValue:n.additionalImportUrls,className:x.additionalImportUrlsTA,onChange:R})]}),e.jsxs("div",{children:[e.jsx("h4",{children:"1回インポートSPARQL"}),e.jsx("textarea",{ref:C,defaultValue:n.oneTimeImportSparql,className:x.oneTimeImportSparqlTA,onChange:R})]}),e.jsxs("div",{children:[e.jsx("h4",{children:"反復インポートSPARQL"}),e.jsx("textarea",{ref:y,defaultValue:n.iterationImportSparql,className:x.iterationImportSparqlTA,onChange:R})]}),e.jsxs("div",{className:x.pathDiv,children:[e.jsx("label",{htmlFor:"rdfURLTB",children:"RDF URL"}),e.jsx("input",{ref:A,type:"text",defaultValue:n.rdfPodUrl,onChange:R})]})]})},tt=({settings:t,onChange:s})=>{const[i,r]=a.useState(!1),[n,l]=a.useState(t.sheets[0]),[u,h]=a.useState("iTha4zah"),[m,p]=a.useState(!1),[w,S]=a.useState(!1),T=a.useRef(null),o=a.useRef(null),f=a.useRef(null),g=a.useRef(null),j=a.useRef(null),b=a.useRef(null),C=a.useRef(null),y=a.useRef(null),A=a.useRef(null),{appData:v}=Q();a.useEffect(()=>{const c=t.sheets.reduce((d,I)=>d!==null?d:I.status===1?I.index:d,null);P(c)},[t]);const P=c=>{if(m&&!window.confirm("設定を保存せずにシートを変更しますか？"))return;p(!1);const d=t.sheets.reduce((I,q)=>I!==null?I:q.index===c?q:I,null);d?(l(d),h(d.index),S(d.repRange!==""),o.current&&(o.current.value=d.repRange),f.current&&(f.current.value=d.prefixes),g.current&&(g.current.value=d.oneTimeTemplate),j.current&&(j.current.value=d.iterationTemplate),b.current&&(b.current.value=d.additionalImportUrls),C.current&&(C.current.value=d.oneTimeImportSparql),y.current&&(y.current.value=d.iterationImportSparql),A.current&&(A.current.value=d.rdfPodUrl)):console.log(`GAHA: There is no sheet: index=${c}???`)},U=()=>{const c=M();if(c.sheetIdx!==u){alert("設定中のシートと、現在アクティブなシートが異なっているので取り込みを中止します。");return}if(c.range.indexOf(":")<0){alert("範囲が選択されていなかったので取り込みを中止します。");return}o.current&&(o.current.value=c.range),p(!0)},L=c=>{f.current&&(f.current.value.endsWith(`
`)||(f.current.value+=`
`),f.current.value+=c.target.textContent,p(!0),r(!1))},F=()=>{o.current&&(o.current.value===""?S(!1):S(!0),p(!0))},z=()=>{p(!0)},R=()=>{p(!0)},V=()=>{T.current&&(t.fileSettings.podUrl=T.current.value),o.current&&(n.repRange=o.current.value),f.current&&(n.prefixes=f.current.value),g.current&&(n.oneTimeTemplate=g.current.value),j.current&&(n.iterationTemplate=j.current.value),b.current&&(n.additionalImportUrls=b.current.value),C.current&&(n.oneTimeImportSparql=C.current.value),y.current&&(n.iterationImportSparql=y.current.value),A.current&&(n.rdfPodUrl=A.current.value),s(t),p(!1),alert("シートの設定を変更しました。")};return e.jsxs("div",{className:x.allSettings,children:[e.jsxs("div",{className:x.title,children:[e.jsx("h3",{children:"ファイル設定"}),e.jsxs("div",{className:x.filePathDiv,children:[e.jsx("label",{htmlFor:"fileURLTB",children:"ファイルURL"}),e.jsx("input",{ref:T,type:"text",defaultValue:t.fileSettings.podUrl,onChange:z})]})]}),e.jsx("div",{className:x.selectedSheetDiv,children:e.jsxs("label",{children:["設定するシート:",e.jsx("select",{value:u,onChange:c=>P(c.target.value),name:"selectedSheet",children:t.sheets.map(c=>e.jsx("option",{value:c.index,children:c.name},c.index))}),e.jsx("span",{style:{color:m?"red":"black"},children:m?"シート設定修正あり":"シート設定修正なし"}),e.jsx("button",{className:x.saveBtn,onClick:V,disabled:!m,children:"設定変更"})]})}),e.jsxs("div",{className:x.repRangeDiv,children:["反復範囲:",e.jsx("input",{ref:o,type:"text",defaultValue:n.repRange,onChange:F}),e.jsx("button",{type:"button",onClick:U,children:"選択範囲から取り込み"})]}),e.jsxs("div",{className:x.prefixDiv,children:[e.jsxs("div",{children:[e.jsx("h4",{children:"プレフィックス"}),e.jsx("span",{className:x.glue}),e.jsx("button",{id:"importPrefixBtn",className:x.importPrefixBtn,onClick:()=>r(!0),children:"プレフィックスを取り込む"})]}),e.jsxs($,{isVisible:i,onClose:()=>r(!1),children:[e.jsx("p",{children:"取り込みたいプレフィックスをクリックして下さい。"}),v.prefixes.split(`
`).map(c=>e.jsx("p",{onClick:L,children:c}))]}),e.jsx("textarea",{ref:f,defaultValue:n.prefixes,className:x.prefixTA,onChange:R})]}),e.jsxs("div",{children:[e.jsx("h4",{children:"1回テンプレート"}),e.jsx("textarea",{ref:g,defaultValue:n.oneTimeTemplate,className:x.oneTimeTemplateTA,onChange:R})]}),e.jsxs("div",{children:[e.jsx("h4",{children:"反復テンプレート"}),e.jsx("textarea",{ref:j,defaultValue:n.iterationTemplate,className:x.iterationTemplateTA,onChange:R,disabled:!w})]}),e.jsxs("div",{children:[e.jsx("h4",{children:"追加インポートRDFのURL"}),e.jsx("textarea",{ref:b,defaultValue:n.additionalImportUrls,className:x.additionalImportUrlsTA,onChange:R})]}),e.jsxs("div",{children:[e.jsx("h4",{children:"1回インポートSPARQL"}),e.jsx("textarea",{ref:C,defaultValue:n.oneTimeImportSparql,className:x.oneTimeImportSparqlTA,onChange:R})]}),e.jsxs("div",{children:[e.jsx("h4",{children:"反復インポートSPARQL"}),e.jsx("textarea",{ref:y,defaultValue:n.iterationImportSparql,className:x.iterationImportSparqlTA,onChange:R})]}),e.jsxs("div",{className:x.pathDiv,children:[e.jsx("label",{htmlFor:"rdfURLTB",children:"RDF URL"}),e.jsx("input",{ref:A,type:"text",defaultValue:n.rdfPodUrl,onChange:R})]})]})},nt="_allSettings_6bzdr_3",st="_title_6bzdr_22",rt="_filePathDiv_6bzdr_27",lt="_selectedSheetDiv_6bzdr_36",it="_saveBtn_6bzdr_45",at="_repRangeDiv_6bzdr_49",ot="_prefixDiv_6bzdr_53",ct="_glue_6bzdr_57",ut="_prefixTA_6bzdr_61",dt="_importPrefixBtn_6bzdr_68",pt="_oneTimeTemplateTA_6bzdr_72",ft="_iterationTemplateTA_6bzdr_79",ht="_additionalImportUrlsTA_6bzdr_86",mt="_oneTimeImportSparqlTA_6bzdr_93",xt="_iterationImportSparqlTA_6bzdr_100",gt="_pathDiv_6bzdr_107",_={allSettings:nt,title:st,filePathDiv:rt,selectedSheetDiv:lt,saveBtn:it,repRangeDiv:at,prefixDiv:ot,glue:ct,prefixTA:ut,importPrefixBtn:dt,oneTimeTemplateTA:pt,iterationTemplateTA:ft,additionalImportUrlsTA:ht,oneTimeImportSparqlTA:mt,iterationImportSparqlTA:xt,pathDiv:gt},vt=({settings:t,onChange:s})=>{const[i,r]=a.useState(!1),[n,l]=a.useState(t.sheets[0]),[u,h]=a.useState("iTha4zah"),[m,p]=a.useState(!1),[w,S]=a.useState(!1),T=a.useRef(null),o=a.useRef(null),f=a.useRef(null),g=a.useRef(null),j=a.useRef(null),b=a.useRef(null),C=a.useRef(null),y=a.useRef(null),A=a.useRef(null),{appData:v}=Q();a.useEffect(()=>{const c=t.sheets.reduce((d,I)=>d!==null?d:I.status===1?I.index:d,null);P(c)},[t]);const P=c=>{if(m&&!window.confirm("設定を保存せずにシートを変更しますか？"))return;p(!1);const d=t.sheets.reduce((I,q)=>I!==null?I:q.index===c?q:I,null);d?(l(d),h(d.index),S(d.repRange!==""),o.current&&(o.current.value=d.repRange),f.current&&(f.current.value=d.prefixes),g.current&&(g.current.value=d.oneTimeTemplate),j.current&&(j.current.value=d.iterationTemplate),b.current&&(b.current.value=d.additionalImportUrls),C.current&&(C.current.value=d.oneTimeImportSparql),y.current&&(y.current.value=d.iterationImportSparql),A.current&&(A.current.value=d.rdfPodUrl)):console.log(`GAHA: There is no sheet: index=${c}???`)},U=()=>{const c=M();if(c.sheetIdx!==u){alert("設定中のシートと、現在アクティブなシートが異なっているので取り込みを中止します。");return}if(c.range.indexOf(":")<0){alert("範囲が選択されていなかったので取り込みを中止します。");return}o.current&&(o.current.value=c.range),p(!0)},L=c=>{f.current&&(f.current.value.endsWith(`
`)||(f.current.value+=`
`),f.current.value+=c.target.textContent,p(!0),r(!1))},F=()=>{o.current&&(o.current.value===""?S(!1):S(!0),p(!0))},z=()=>{p(!0)},R=()=>{p(!0)},V=()=>{T.current&&(t.fileSettings.podUrl=T.current.value),o.current&&(n.repRange=o.current.value),f.current&&(n.prefixes=f.current.value),g.current&&(n.oneTimeTemplate=g.current.value),j.current&&(n.iterationTemplate=j.current.value),b.current&&(n.additionalImportUrls=b.current.value),C.current&&(n.oneTimeImportSparql=C.current.value),y.current&&(n.iterationImportSparql=y.current.value),A.current&&(n.rdfPodUrl=A.current.value),s(t),p(!1),alert("シートの設定を変更しました。")};return e.jsxs("div",{className:_.allSettings,children:[e.jsxs("div",{className:_.title,children:[e.jsx("h3",{children:"ファイル設定"}),e.jsxs("div",{className:_.filePathDiv,children:[e.jsx("label",{htmlFor:"fileURLTB",children:"ファイルURL"}),e.jsx("input",{ref:T,type:"text",defaultValue:t.fileSettings.podUrl,onChange:z})]})]}),e.jsx("div",{className:_.selectedSheetDiv,children:e.jsxs("label",{children:["設定するシート:",e.jsx("select",{value:u,onChange:c=>P(c.target.value),name:"selectedSheet",children:t.sheets.map(c=>e.jsx("option",{value:c.index,children:c.name},c.index))}),e.jsx("span",{style:{color:m?"red":"black"},children:m?"シート設定修正あり":"シート設定修正なし"}),e.jsx("button",{className:_.saveBtn,onClick:V,disabled:!m,children:"設定変更"})]})}),e.jsxs("div",{className:_.repRangeDiv,children:["反復範囲:",e.jsx("input",{ref:o,type:"text",defaultValue:n.repRange,onChange:F}),e.jsx("button",{type:"button",onClick:U,children:"選択範囲から取り込み"})]}),e.jsxs("div",{className:_.prefixDiv,children:[e.jsxs("div",{children:[e.jsx("h4",{children:"プレフィックス"}),e.jsx("span",{className:_.glue}),e.jsx("button",{id:"importPrefixBtn",className:_.importPrefixBtn,onClick:()=>r(!0),children:"プレフィックスを取り込む"})]}),e.jsxs($,{isVisible:i,onClose:()=>r(!1),children:[e.jsx("p",{children:"取り込みたいプレフィックスをクリックして下さい。"}),v.prefixes.split(`
`).map(c=>e.jsx("p",{onClick:L,children:c}))]}),e.jsx("textarea",{ref:f,defaultValue:n.prefixes,className:_.prefixTA,onChange:R})]}),e.jsxs("div",{children:[e.jsx("h4",{children:"1回テンプレート"}),e.jsx("textarea",{ref:g,defaultValue:n.oneTimeTemplate,className:_.oneTimeTemplateTA,onChange:R})]}),e.jsxs("div",{children:[e.jsx("h4",{children:"反復テンプレート"}),e.jsx("textarea",{ref:j,defaultValue:n.iterationTemplate,className:_.iterationTemplateTA,onChange:R,disabled:!w})]}),e.jsxs("div",{children:[e.jsx("h4",{children:"追加インポートRDFのURL"}),e.jsx("textarea",{ref:b,defaultValue:n.additionalImportUrls,className:_.additionalImportUrlsTA,onChange:R})]}),e.jsxs("div",{children:[e.jsx("h4",{children:"1回インポートSPARQL"}),e.jsx("textarea",{ref:C,defaultValue:n.oneTimeImportSparql,className:_.oneTimeImportSparqlTA,onChange:R})]}),e.jsxs("div",{children:[e.jsx("h4",{children:"反復インポートSPARQL"}),e.jsx("textarea",{ref:y,defaultValue:n.iterationImportSparql,className:_.iterationImportSparqlTA,onChange:R})]}),e.jsxs("div",{className:_.pathDiv,children:[e.jsx("label",{htmlFor:"rdfURLTB",children:"RDF URL"}),e.jsx("input",{ref:A,type:"text",defaultValue:n.rdfPodUrl,onChange:R})]})]})},St="_allAppSettings_plc8o_3",jt="_prefixesDiv_plc8o_10",Tt="_prefixesTA_plc8o_15",yt="_idpDiv_plc8o_20",bt="_idpTB_plc8o_26",J={allAppSettings:St,prefixesDiv:jt,prefixesTA:Tt,idpDiv:yt,idpTB:bt},Rt=()=>{const{appData:t,updateAppData:s}=Q(),i=a.useRef(null),r=a.useRef(null),n=()=>{var u,h;const l={prefixes:(u=i.current)==null?void 0:u.value,idp:(h=r.current)==null?void 0:h.value};s(l),alert("アプリ設定を保存しました。")};return e.jsxs("div",{className:J.allAppSettings,children:[e.jsx("h3",{children:"AppSettings"}),e.jsx("p",{children:"編集中のファイルではなくアプリの設定をします。"}),e.jsx("h4",{children:"プレフィックス"}),e.jsx("div",{className:J.prefixesDiv,children:e.jsx("textarea",{ref:i,className:J.prefixesTA,defaultValue:t.prefixes})}),e.jsx("h4",{children:"デフォルトのログイン場所"}),e.jsx("div",{className:J.idpDiv,children:e.jsx("input",{ref:r,className:J.idpTB,defaultValue:t.idp})}),e.jsx("button",{onClick:n,children:"変更"})]})},At=({settings:t,onLoaded:s})=>{const i=a.useRef(null);a.useEffect(()=>{const l=t.fileSettings.podUrl;l&&i.current&&(i.current.value=l)},[t]);const r=async()=>{await ge(),s()},n=async()=>{if(!i.current)return;const l=i.current.value;await ve(l),s()};return e.jsxs(e.Fragment,{children:[e.jsx("h4",{children:"LoadComponent"}),e.jsx("div",{children:e.jsx("button",{type:"button",onClick:r,children:"load from local"})}),e.jsxs("div",{style:{display:"flex",margin:"1em 0"},children:[e.jsx("button",{type:"button",onClick:n,children:"load from pod"}),e.jsx("input",{type:"text",ref:i,style:{flexGrow:1}})]})]})},Ct=({settings:t,onSaved:s})=>{const i=a.useRef(null);a.useEffect(()=>{const l=t.fileSettings.podUrl;l&&i.current&&(i.current.value=l)},[t]);const r=()=>{Se(),s()},n=()=>{if(!i.current)return;const l=i.current.value;je(l),s()};return e.jsxs(e.Fragment,{children:[e.jsx("h4",{children:"SaveComponent"}),e.jsx("div",{children:e.jsx("button",{type:"button",onClick:r,children:"save to local"})}),e.jsxs("div",{style:{display:"flex",margin:"1em 0"},children:[e.jsx("button",{type:"button",onClick:n,children:"save to pod"}),e.jsx("input",{type:"text",ref:i,style:{flexGrow:1}})]})]})},It=({settings:t,onImported:s})=>{const i=a.useRef(null);a.useEffect(()=>{const l=t.sheets.reduce((u,h)=>u!==null?u:h.status===1?h.rdfPodUrl:u,null);l&&i.current&&(i.current.value=l)},[t]);const r=()=>{Te(),s()},n=()=>{if(!i.current)return;const l=i.current.value;ye(l),s()};return e.jsxs(e.Fragment,{children:[e.jsx("h4",{children:"ImportComponent"}),e.jsx("div",{children:e.jsx("button",{type:"button",onClick:r,children:"import from local"})}),e.jsxs("div",{style:{display:"flex",margin:"1em 0"},children:[e.jsx("button",{type:"button",onClick:n,children:"import from pod"}),e.jsx("input",{type:"text",ref:i,style:{flexGrow:1}})]})]})},_t=({settings:t,onExported:s})=>{const i=a.useRef(null);a.useEffect(()=>{const l=t.sheets.reduce((u,h)=>u!==null?u:h.status===1?h.rdfPodUrl:u,null);l&&i.current&&(i.current.value=l)},[t]);const r=()=>{be(),s()},n=()=>{if(!i.current)return;const l=i.current.value;Re(l),s()};return e.jsxs(e.Fragment,{children:[e.jsx("h4",{children:"ExportComponent"}),e.jsx("div",{children:e.jsx("button",{type:"button",onClick:r,children:"export to local"})}),e.jsxs("div",{style:{display:"flex",margin:"1em 0"},children:[e.jsx("button",{type:"button",onClick:n,children:"export to pod"}),e.jsx("input",{type:"text",ref:i,style:{flexGrow:1}})]})]})},wt=()=>{const[t,s]=a.useState(N.settings),[i,r]=a.useState(!0),[n,l]=a.useState(!1),[u,h]=a.useState(!1),[m,p]=a.useState(!1),[w,S]=a.useState(!1),[T,o]=a.useState(!1),[f,g]=a.useState(!1),[j,b]=a.useState(!1),[C,y]=a.useState(!1),A=v=>{v==="sheets"?(r(!0),p(!1),S(!1),l(!1),h(!1)):v==="settings"?(s(E()),r(!1),p(!0),S(!1),l(!1),h(!1)):v==="appSettings"?(r(!1),p(!1),S(!0),l(!1),h(!1)):v==="load"?o(!0):v==="save"?g(!0):v==="import"?b(!0):v==="export"?y(!0):v==="help"?Ae():v==="about"?Ce():console.log("GAHA: ????????")};return e.jsxs(we,{children:[e.jsxs("header",{children:[e.jsx(ke,{onSelect:A}),e.jsxs("div",{className:_e.headerPanels,children:[e.jsx(De,{}),e.jsxs("div",{children:[e.jsx("button",{onClick:()=>{l(!0),r(!1)},children:"Export"}),e.jsx("button",{onClick:()=>{h(!0),r(!1)},children:"Import"})]})]})]}),e.jsxs("main",{children:[e.jsx(Fe,{isVisible:i,children:e.jsx(qe,{onLoad:v=>s(v)})}),n===!0?e.jsx(et,{settings:t,onChange:v=>s(v)}):null,u===!0?e.jsx(tt,{settings:t,onChange:v=>s(v)}):null,m===!0?e.jsx(vt,{settings:t,onChange:v=>s(v)}):null,w===!0?e.jsx(Rt,{}):null]}),e.jsx($,{isVisible:T,onClose:()=>o(!1),children:e.jsx(At,{settings:t,onLoaded:()=>{o(!1),s(N.settings)}})}),e.jsx($,{isVisible:f,onClose:()=>g(!1),children:e.jsx(Ct,{settings:t,onSaved:()=>g(!1)})}),e.jsx($,{isVisible:j,onClose:()=>b(!1),children:e.jsx(It,{settings:t,onImported:()=>b(!1)})}),e.jsx($,{isVisible:C,onClose:()=>y(!1),children:e.jsx(_t,{settings:t,onExported:()=>y(!1)})})]})};async function Dt(){await me();const t=window;let s=null;t.launchQueue&&t.launchQueue.setConsumer&&t.launchQueue.setConsumer(async i=>{s||i.files.length&&(s=new Promise(async r=>{const u=await(await i.files[0].getFile()).text();localStorage.setItem("RDFSheetTempFile",u),r()}))}),s&&await s,re.createRoot(document.getElementById("root")).render(e.jsx(a.StrictMode,{children:e.jsx(wt,{})}))}Dt();
